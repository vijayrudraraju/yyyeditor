<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>yyy banners edit</title>
        <meta name="description" content="page for editing banners">
        <meta name="programmer" content="vijay rudraraju">

        <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- Le styles -->
        <link href="../../static/css/bootstrap.css" rel="stylesheet">
        <style type="text/css">
            .container > footer p {
                text-align: center; /* center align it with the container */
            }

            .topbar .btn {
                border: 0;
            }

            #banner-image {
                width: 940px;
                height: 100px;
                margin: 0px auto; padding:0;
            }

            .thumbnail {
                width: 90px;
                height: 90px;
            }
        </style>

        <script src="/_utils/script/json2.js"></script>
        <!--<script src="../../script/jquery.js"></script>-->
        <script src="/_utils/script/jquery.js"></script>
        <script src="/_utils/script/jquery.couch.js"></script>
        <script src="../../script/jquery.form.js"></script>
        <script src="../../script/bootstrap-modal.js"></script>
        <script>
            var dbName = 'yyy';
            var bannersDocName = 'banners';
            var bannersDoc = {};

            function loadBanner() {
                $.couch.db(dbName).openDoc(bannersDocName, {
                    success: function(data) {
                        console.log(data);
                        bannersDoc = data;
                        if (bannersDoc.data.length !== 0) {
                            for (var i=0;i<bannersDoc.data.length;i++) {
                                if (bannersDoc.data[i].active) {
                                    console.log('load banner');
                                    $.couch.db(dbName).openDoc(bannersDoc.data[i].docid, {
                                        success: function(data) {
                                            console.log(data);
                                            $('#banner-image').css('background','url(/'+dbName+'/'+data._id+'/'+data.logo+')');
                                        },
                                        error: function(data) {
                                            console.log(data);
                                        }
                                    });
                                }
                            }
                        }
                    },
                    error: function(data) {
                        console.log(data);
                    }
                });
            }

            function saveBannersDoc(doc) {
                $.couch.db(dbName).saveDoc(doc, {
                    success: function(data) {
                        console.log(data);
                        loadBanner();
                    },
                    error: function(data) {
                        console.log(data);
                    }
                });
            }

            /*
            $(function(){
                loadBanner();
                console.log('bannersDoc');
                console.log(bannersDoc);

                $('#inner-content div:first').append('<p>{{logo}}</p>');
                $('#inner-content div:first').append('<img src="/'+dbName+'/'+{{{id}}}+'/{{logo}}" alt=""></a>');

                $('#activate').click(function(e) {
                    var thisBanner = {{{doc}}};

                    e.preventDefault();
                    if (!$.isEmptyObject(bannersDoc)) {
                        for (var i=0;i<bannersDoc.data.length;i++) {
                            if (bannersDoc.data[i].docid === {{{id}}}) {
                                bannersDoc.data[i].active = true;
                            } 
                            else {
                                bannersDoc.data[i].active = false;
                            }
                        }
                    }
                    saveBannersDoc(bannersDoc);
                });

                $('#delete').click(function(e) {
                    e.preventDefault();
                    $('#delete-confirm').modal('show'); 
                });
                $('#cancel-delete').click(function(e) {
                    e.preventDefault();
                    $('#delete-confirm').modal('hide'); 
                });
                $('#confirm-delete').click(function(e) {
                    e.preventDefault();

                    var thisBanner = {{{doc}}};
                    var thisId = {{{id}}};

                    if (!$.isEmptyObject(bannersDoc)) {
                        for (var i=0;i<bannersDoc.data.length;i++) {
                            if (bannersDoc.data[i].docid === thisId) {
                                bannersDoc.data.splice(i,1); 
                                break;
                            }
                        }
                        saveBannersDoc(bannersDoc);


                        $.couch.db(dbName).removeDoc({{{doc}}}, {
                            success: function(data) {
                                console.log(data);
                                window.location.href = '../../banners.html';
                            },
                            error: function(data) {
                                console.log(data);
                            }
                        });
                    }
                });
            });
            */
        </script>
    </head>

    <body>
        <div class="container">
            <div id="delete-confirm" class="modal hide">
                <div class="modal-header">
                    <h3>really?</h3>
                </div>
                <div class="modal-body">
                    <p>are you sure you want to delete this banner?</p>
                </div>
                <div class="modal-footer">
                    <button id="confirm-delete" class="btn primary">yup</button>
                    <button id="cancel-delete" class="btn secondary">noooo</button>
                </div>
            </div>

            <div class="content">
                <div class="page-header">
                    <ul id="banner-image">
                    </ul>
                </div>
                <ul class="tabs">
                    <li class="active"><a href="../../banners.html">banners</a></li>
                    <li><a href="../../authors.html">authors</a></li>
                    <li><a href="../../articles.html">articles</a></li>
                </ul>
                <ul class="breadcrumb">
                    <li><a href="../../banners.html">all</a> <span class="divider">/</span></li>
                    <!--<li class="active">{{logo}}</li>-->
                </ul>
                <div class="row" id="inner-content">
                    <div class="span8">
                    </div>
                    <div class="span8">
                        <form>
                            <div class="clearfix">
                                <div class="input">
                                    <button id="activate" class="btn primary">make active</button>
                                </div>
                            </div>
                            <div class="clearfix">
                                <div class="input">
                                    <button id="delete" class="btn">delete me</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div> <!-- /container -->
    </body>
</html>

